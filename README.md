# FEC_for_Lossy_Networks
Lightweight FEC Transmission Module for Enhanced Network Reliability

![Language](https://img.shields.io/badge/language-c-brightgreen)
![License](https://img.shields.io/badge/license-MIT-yellow)
![Documentation](https://img.shields.io/badge/documentation-yes-brightgreen)

# ä¸€å¥—ç”¨äºç½‘ç»œä¼ è¾“çš„FEC Framework
## ç®€ä»‹:  
FEC(å‰å‘çº é”™)é€šè¿‡åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­å¢åŠ å†—ä½™æ•°æ®æ¥æé«˜æ•°æ®å®Œæ•´æ€§ï¼Œå‡å°‘é‡ä¼ éœ€æ±‚ï¼Œä»è€Œä¼˜åŒ–äº†ç½‘ç»œæ€§èƒ½å’Œæ•ˆç‡ã€‚è¿™äº›ç‰¹æ€§ä½¿å¾—FECæˆä¸ºæé«˜ç½‘ç»œé€šä¿¡å¯é æ€§çš„é‡è¦å·¥å…·ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸ç¨³å®šæˆ–èµ„æºå—é™çš„ç½‘ç»œç¯å¢ƒä¸­ã€‚ 

æœ¬é¡¹ç›®çš„ä¸»è¦ç›®çš„æ˜¯å¼€å‘ä¸€æ¬¾è½»é‡çº§ã€é«˜æ•ˆã€å¼ºå¥çš„FECä¼ è¾“æ¨¡å—ã€‚è¯¥æ¨¡å—ä¸“ä¸ºæé«˜ç½‘ç»œé€šä¿¡ä¸­çš„æ•°æ®å¯é æ€§å’Œå®Œæ•´æ€§è€Œè®¾è®¡ï¼Œå°¤å…¶é€‚ç”¨äºæ˜“äºå‘ç”Ÿæ•°æ®åŒ…ä¸¢å¤±å’Œä¼ è¾“é”™è¯¯çš„ç¯å¢ƒã€‚é€šè¿‡å®æ–½åŸºäºReed-Solomonç¼–ç çš„FECæ–¹æ¡ˆï¼Œé¡¹ç›®æ—¨åœ¨æ˜¾è‘—å‡å°‘æ•°æ®åŒ…ä¸¢å¤±çš„å½±å“ï¼Œä»è€Œæé«˜åœ¨å„ç§ç½‘ç»œæ¡ä»¶ä¸‹çš„æ•´ä½“æ€§èƒ½å’Œå¯é æ€§ã€‚

## æŠ€æœ¯ç‰¹æ€§

**ğŸ˜Šå…·æœ‰ä¸€å®šçš„åè®®å°è£…, åº”ç”¨å±‚åœ¨å‘é€å‰, å¯å°†æ•°æ®äº¤ç”±FEC Framework. FEC Frameworkä¼šå®Œæˆåè®®å¤´çš„å¡«å……ä»¥åŠè§£æ.**  

**ğŸ˜Šæ¯å‘é€kåŒ…åº”ç”¨å±‚æ•°æ®, å°†äº§ç”ŸmåŒ…å†—ä½™æ•°æ®. k, mçš„å–å€¼å¯ç”±åº”ç”¨å±‚æŒ‰éœ€è°ƒæ•´, k >= 1 && k+m <= 32å³å¯**  

**ğŸ˜Šk+mä¸ºä¸€ç»„fecæ•°æ®å—, å¦‚æœæœ‰<=måŒ…æ•°æ®ä¸¢å¤±, æ¥æ”¶æ–¹å¯æ ¹æ®fecä¿¡æ¯æ¢å¤ä¸¢å¤±çš„æ•°æ®**  

**ğŸ˜Šå½“ä¸€ç»„fecæ•°æ®å—ä»¥ä¹±åºåˆ°è¾¾æ¥æ”¶ç«¯æ—¶, ä¾ç„¶èƒ½å¤Ÿæ¢å¤å‡ºä¸¢å¤±çš„æ•°æ®**  

**ğŸ˜ŠFEC Schemeé‡‡ç”¨çš„æ˜¯Reed-Solomonç¼–ç æ–¹æ¡ˆ, è¯¥ç¼–ç æ˜¯ä¸€ç§å¸¸è§ä¸”åŠŸèƒ½å¼ºå¤§çš„FECç®—æ³•ï¼Œé€‚ç”¨äºå„ç§åº”ç”¨ã€‚**  


## FEC Frameworkå‚æ•°è¯´æ˜

â“k: Source Packetæ•°é‡, åŸå§‹æ•°æ®åŒ…çš„æ•°é‡ã€‚  
â“m: Parity Packetæ•°é‡, ç”Ÿæˆçš„æ ¡éªŒæ•°æ®åŒ…çš„æ•°é‡  
â“n: æ¯ä¸ªFEC BlockåŒ…å«çš„æ•°æ®åŒ…æ•°é‡ï¼Œç­‰äºk + mï¼ˆnï¼‰ã€‚

## ä½¿ç”¨æ¦‚è§ˆ

### å‘é€ç«¯æµç¨‹
![å‘é€ç«¯æµç¨‹](/doc/image/sender_op.jpeg)

### æ¥æ”¶ç«¯æµç¨‹
![æ¥æ”¶ç«¯æµç¨‹](/doc/image/recver_op.jpg)

# APIè¯´æ˜
### åˆå§‹åŒ–
```C
fec_info_t *fec_framework_init(IUINT8 k, IUINT8 n)
```
- **åŠŸèƒ½æè¿°**  
åˆå§‹åŒ–fec framework

- **å‚æ•°è¯´æ˜**  
    - k: Source Packetæ•°é‡, åŸå§‹æ•°æ®åŒ…çš„æ•°é‡ã€‚  
    - n: æ¯ä¸ªFEC BlockåŒ…å«çš„æ•°æ®åŒ…æ•°é‡ï¼Œç­‰äºk + mã€‚  
ä¸€æ—¦ç¡®å®šäº†kä¸nå, fec frameworkåœ¨æ¥å—kåŒ…åº”ç”¨å±‚æ•°æ®æ—¶, ä¼šç”ŸæˆmåŒ…å†—ä½™æ•°æ®

- **è¿”å›å€¼**  
æˆåŠŸè¿”å›fec_frameworkå¥æŸ„, å¤±è´¥è¿”å›NULL

### ååˆå§‹åŒ–
```C
void fec_framework_deinit(fec_info_t *fec_info)
```
- **åŠŸèƒ½æè¿°**  
ååˆå§‹åŒ–fec framework

- **å‚æ•°è¯´æ˜**  
  - fec_info: ç”±fec_framework_initåˆ›å»ºçš„å¥æŸ„

- **è¿”å›å€¼**  
æ— 

### FEC encode

```C
IINT32
fec_framework_encode(fec_info_t *fec_info, struct fec_buf *ubuf, struct fec_buf **out_ubuf, IINT32 *out_ubuf_count)
```
- **åŠŸèƒ½æè¿°**  
  - ç”¨äºå°†åº”ç”¨å±‚æ•°æ®ï¼ˆApplication Data Unit, ADUï¼‰å°è£…è¿›FECæŠ¥æ–‡å¤´ï¼Œä»¥ç”ŸæˆFECæ•°æ®åŒ…ï¼ˆForward Error Correction Data Unit, FDUï¼‰ã€‚
  - è¯¥å‡½æ•°åœ¨è¢«åº”ç”¨å±‚è°ƒç”¨kæ¬¡ä¹‹åï¼Œé™¤äº†è¿”å›åŸå§‹æ•°æ®å¤–ï¼Œè¿˜ä¼šé¢å¤–ç”Ÿæˆmä¸ªå†—ä½™æ•°æ®åŒ…ã€‚è¿™äº›å†—ä½™æ•°æ®åŒ…æœ‰åŠ©äºåœ¨æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­æ¢å¤ä¸¢å¤±æˆ–æŸåçš„æ•°æ®åŒ…ã€‚

- **å‚æ•°è¯´æ˜**
  - fec_info
    - æè¿°: è¿™æ˜¯ä¸€ä¸ªç”±fec_framework_initå‡½æ•°åˆ›å»ºçš„å¥æŸ„ã€‚å®ƒåŒ…å«äº†FECç¼–ç æ‰€éœ€çš„æ‰€æœ‰é…ç½®å’ŒçŠ¶æ€ä¿¡æ¯ã€‚
    - ç”¨é€”: æŒ‡å¯¼FECç¼–ç è¿‡ç¨‹ï¼ŒåŒ…æ‹¬å¦‚ä½•ç”Ÿæˆå†—ä½™æ•°æ®ç­‰ã€‚
  - ubuf
    - æè¿°: æŒ‡å‘åº”ç”¨å±‚æ•°æ®ï¼ˆADUï¼‰çš„æŒ‡é’ˆã€‚è¿™äº›æ•°æ®æ˜¯éœ€è¦è¢«FECç®—æ³•å¤„ç†çš„åŸå§‹æ•°æ®ã€‚
    - ç”¨é€”: ä½œä¸ºFECç¼–ç çš„è¾“å…¥ï¼Œå³å°†è¢«åŠ å…¥FECå¤´éƒ¨çš„æ•°æ®ã€‚
  - out_ubuf
    - æè¿°: è¾“å‡ºå‚æ•°. ä¸ºADUæ·»åŠ äº†FECå¤´éƒ¨çš„FEC packet(FDU)
    - ç”¨é€”ï¼šå­˜æ”¾ç¼–ç åçš„æ•°æ®ï¼ŒåŒ…æ‹¬åŸå§‹æ•°æ®å’Œç”Ÿæˆçš„å†—ä½™æ•°æ®ã€‚
  - out_ubuf_count
    - æè¿°: è¾“å‡ºå‚æ•°. è¡¨ç¤ºè¾“å‡ºçš„FDUæ•°é‡ã€‚å¦‚æœfec_framework_encodeå‡½æ•°æ²¡æœ‰äº§ç”Ÿé¢å¤–çš„å†—ä½™æ•°æ®ï¼Œåˆ™out_ubuf_countçš„å€¼ä¸º1ã€‚
    - ç”¨é€”ï¼šæä¾›äº†è¾“å‡ºFDUæ•°ç»„çš„é•¿åº¦ï¼Œå¸®åŠ©è°ƒç”¨è€…äº†è§£æœ‰å¤šå°‘ä¸ªFDUéœ€è¦è¿›ä¸€æ­¥å¤„ç†ã€‚

- **è¿”å›å€¼**
  - æˆåŠŸè¿”å›0, å¤±è´¥è¿”å›-1

### FEC decode
```C
IINT32
fec_framework_decode(fec_info_t *fec_info, struct fec_buf *ubuf, struct fec_buf **out_ubuf, IINT32 *out_ubuf_count)
```
- **åŠŸèƒ½æè¿°**  
  FECæ¡†æ¶çš„è§£ç éƒ¨åˆ†ï¼Œä¸»è¦ç”¨äºFECæ¥æ”¶ç«¯ã€‚è¯¥å‡½æ•°çš„ç›®çš„æ˜¯å¤„ç†æ¥æ”¶åˆ°çš„FECæ•°æ®åŒ…ï¼ˆFDUï¼‰ï¼Œå¹¶å°è¯•ä»ä¸­æ¢å¤åŸå§‹åº”ç”¨å±‚æ•°æ®ï¼ˆADUï¼‰ã€‚
  è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬:  
  - è§£æFECå¤´éƒ¨;
  - ä»¥åŠæ ¹æ®æ¥æ”¶åˆ°çš„åŸå§‹æ•°æ®å’Œå†—ä½™æ•°æ®é‡å»ºä¸¢å¤±çš„æ•°æ®åŒ…ã€‚

- **å‚æ•°è¯´æ˜**
  - fec_info
    - æè¿°: è¿™æ˜¯ä¸€ä¸ªç”±fec_framework_initå‡½æ•°åˆ›å»ºçš„å¥æŸ„ã€‚å®ƒåŒ…å«äº†FECç¼–ç æ‰€éœ€çš„æ‰€æœ‰é…ç½®å’ŒçŠ¶æ€ä¿¡æ¯ã€‚
    - ç”¨é€”: ä¸ºFECè§£ç è¿‡ç¨‹æä¾›å¿…è¦çš„æŒ‡å¯¼ï¼ŒåŒ…æ‹¬å¦‚ä½•å¤„ç†æ¥æ”¶åˆ°çš„æ•°æ®åŒ…ã€‚
  - ubuf
    - æè¿°: æŒ‡å‘æ¥æ”¶åˆ°çš„FECæ•°æ®åŒ…ï¼ˆFDUï¼‰çš„æŒ‡é’ˆã€‚è¿™äº›æ•°æ®åŒ…å¯èƒ½æ˜¯åŸå§‹æ•°æ®æˆ–ç”±å‘é€ç«¯ç”Ÿæˆçš„å†—ä½™æ•°æ®ã€‚
    - ç”¨é€”: ä½œä¸ºFECè§£ç çš„è¾“å…¥ï¼Œæä¾›éœ€è¦è§£ç å’Œé‡å»ºçš„æ•°æ®ã€‚
  - out_ubuf
    - æè¿°: è¾“å‡ºå‚æ•°. ä¸ºADUæ·»åŠ äº†FECå¤´éƒ¨çš„FEC packet(FDU)
    - ç”¨é€”ï¼šå­˜æ”¾ç¼–ç åçš„æ•°æ®ï¼ŒåŒ…æ‹¬åŸå§‹æ•°æ®å’Œç”Ÿæˆçš„å†—ä½™æ•°æ®ã€‚
  - out_ubuf_count
    - æè¿°: è¾“å‡ºå‚æ•°. è¡¨ç¤ºè¾“å‡ºçš„ADUæ•°é‡ã€‚è¿™ä¸ªæ•°å€¼æŒ‡ç¤ºäº†æˆåŠŸè§£ç å’Œé‡å»ºçš„æ•°æ®åŒ…æ•°é‡ã€‚
    - ç”¨é€”ï¼šæä¾›äº†è¾“å‡ºADUæ•°ç»„çš„é•¿åº¦ï¼Œå¸®åŠ©è°ƒç”¨è€…äº†è§£æœ‰å¤šå°‘ä¸ªæ•°æ®åŒ…, è¿™ä¹ŸåŒ…å«è¢«æˆåŠŸæ¢å¤çš„æ•°æ®åŒ…ã€‚

- **è¿”å›å€¼**
  - æˆåŠŸè¿”å›0, å¤±è´¥è¿”å›-1

# è°ƒç”¨æµç¨‹
1. åˆ›å»ºfec frameworkå¯¹è±¡

    ```C
    //æŒ‰ç…§k=3,n=4çš„ç ç‡åˆå§‹åŒ–fec.
    //ä¹Ÿå°±æ˜¯è¯´:æ¯è°ƒç”¨3æ¬¡fec_framework_encodeå‡½æ•°å, fec_framework_encodeä¼šç”Ÿæˆ1åŒ…å†—ä½™æ•°æ®(4 - 3).ã€€
    fec_info = fec_framework_init(3, 4);
    ```

2. åº”ç”¨å±‚è°ƒç”¨fec_framework_encodeè¿›è¡Œç¼–ç 

    ```C
    //fec_framework_encodeä»…è´Ÿè´£ç¼–ç å·¥ä½œ.çœŸæ­£çš„å‘é€è¿˜éœ€åº”ç”¨å±‚å¤„ç†.
    ret = fec_framework_encode(fec_info, &ubuf, &out_ubuf, &out_ubuf_count);
    ```
3. åº”ç”¨å±‚æ ¹æ®out_ubuf_countçš„å€¼å‘é€æ•°æ®

    ```C
    for (int i = 0; i < out_ubuf_count; i++) {
      sendto(udp_socket, fec_buf_data(&out_ubuf[i]), fec_buf_length(&out_ubuf[i]), flags, dest_addr, addrlen);
    }
    ```
4. åº”ç”¨å±‚è°ƒç”¨recvfromæ¥æ”¶æ•°æ®

5. åº”ç”¨å±‚å¯æ ¹æ®æƒ…å†µå†³å®šæ˜¯å¦äº¤ç”±FEC Frameworkå¤„ç†

    ```C
    if (adu->need_fec_decode) {
      fec_framework_decode(fec_info, ubuf, &out_ubuf, &out_ubuf_count);
    }
    ```
6. é€šè¿‡out_ubuf_countçš„å€¼è¿›è¡Œå¾ªç¯å¤„ç†

    ```C
    for (int i = 0; i < out_ubuf_count; i++) {
      app_proc_func(out_ubuf[i]);
      ...
    }
    ```
